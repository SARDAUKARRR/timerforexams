<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yüksek Hassasiyetli Sınav Kronometresi</title>
    <style>
        /* * ADIM 1: TEMEL STİL AYARLARI VE KARANLIK TEMA
         * - Sadece siyah, beyaz ve gri tonları kullanarak minimalist ve modern bir karanlık tema oluşturulmuştur.
        */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #000000;
            color: #cccccc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* * ADIM 2: ANA YAPI ELEMENTLERİNİN STİLLENDİRİLMESİ (HEADER, MAIN, SIDEBAR)
         * - Uygulamanın üç ana bölümü (üst başlık, ana içerik, sağ panel) düzenlenmiştir.
        */

        .header {
            background: #0a0a0a;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #1a1a1a;
        }

        .app-title {
            font-size: 14px;
            font-weight: 400;
            margin-bottom: 15px;
            color: #606060;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .main-timer {
            font-size: 48px;
            font-weight: 300;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            color: #e0e0e0;
            margin: 15px 0;
            letter-spacing: 2px;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        button {
            background: #1a1a1a;
            color: #999999;
            border: 1px solid #2a2a2a;
            padding: 10px 20px;
            font-size: 12px;
            font-weight: 400;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover:not(:disabled) {
            background: #252525;
            color: #ffffff;
            border-color: #444444;
        }

        button:active:not(:disabled) {
            background: #1a1a1a;
        }

        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        button.active {
            color: #ffffff;
            border-color: #ffffff;
        }

        .main-container {
            display: flex;
            flex: 1;
            padding: 30px;
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #0a0a0a;
            border-radius: 8px;
            padding: 40px;
            border: 1px solid #1a1a1a;
        }
        
        .question-number {
            font-size: 14px;
            color: #606060;
            margin-bottom: 20px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .question-timer {
            font-size: 72px;
            font-weight: 200;
            font-family: 'SF Mono', Monaco, 'Courier New', monospace;
            color: #ffffff;
            margin: 20px 0;
            letter-spacing: 4px;
        }

        .sidebar {
            width: 320px;
            background: #0a0a0a;
            border-radius: 8px;
            padding: 25px;
            border: 1px solid #1a1a1a;
            display: flex;
            flex-direction: column;
        }

        .sidebar h2 {
            color: #606060;
            margin-bottom: 20px;
            text-align: center;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 400;
        }

        .question-list {
            flex: 1;
            overflow-y: auto;
        }
        .question-list::-webkit-scrollbar { width: 4px; }
        .question-list::-webkit-scrollbar-track { background: #0a0a0a; }
        .question-list::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 2px; }

        .question-item {
            margin-bottom: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 2px solid #2a2a2a;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .question-item:hover {
            background: #0f0f0f;
            border-left-color: #555555;
        }

        /* * ADIM 3: MODAL (POP-UP) PENCERESİNİN DETAYLI STİLLENDİRİLMESİ
         * - Tüm ekranı kaplayan, yarı saydam bir arka plana sahip modal oluşturulmuştur.
         * - İstatistik kartları, listeler ve tablolar için interaktif ve modern bir tasarım yapılmıştır.
        */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            overflow-y: auto;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #0f0f0f;
            margin: 5% auto;
            padding: 40px;
            border: 1px solid #2a2a2a;
            border-radius: 16px;
            width: 95%;
            max-width: 1000px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: modalSlideIn 0.4s ease-out;
            position: relative;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }

        .close-icon {
            position: absolute;
            top: 20px; right: 25px;
            color: #505050;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-icon:hover { color: #ffffff; }

        .modal-header h2 {
            color: #ffffff;
            font-size: 28px;
            font-weight: 300;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: #151515;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #2a2a2a;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #555555;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .stat-label { color: #606060; font-size: 11px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1.5px; }
        .stat-value { color: #ffffff; font-size: 32px; font-weight: 200; font-family: 'SF Mono', Monaco, 'Courier New', monospace; }
        .stat-subvalue { color: #606060; font-size: 14px; margin-top: 5px; }

        .performance-sections { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        .performance-section { background: #0a0a0a; padding: 25px; border-radius: 12px; border: 1px solid #2a2a2a; }
        .performance-section h3 { color: #808080; font-size: 14px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; font-weight: 400; padding-bottom: 10px; border-bottom: 1px solid #1a1a1a; }
        .performance-list li { display: flex; justify-content: space-between; padding: 10px; margin-bottom: 5px; background: #111111; border-radius: 6px; font-size: 13px; transition: all 0.2s; }
        .performance-list li:hover { background: #1f1f1f; transform: translateX(5px); }
        .fastest-list li { border-left: 3px solid #cccccc; }
        .slowest-list li { border-left: 3px solid #555555; }
        
        .detailed-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .detailed-table th, .detailed-table td { padding: 12px; text-align: left; border-top: 1px solid #1a1a1a; }
        .detailed-table th { color: #606060; font-weight: 500; text-transform: uppercase; font-size: 11px; }
        .detailed-table tbody tr:hover { background: #1a1a1a; }
        .time-cell { font-family: 'SF Mono', Monaco, 'Courier New', monospace; color: #bbbbbb; }

        .modal-actions { text-align: center; margin-top: 40px; display: flex; justify-content: center; gap: 15px; }
        
        #newExamBtn {
            background: #ffffff;
            color: #000000;
            border-color: #ffffff;
            font-weight: bold;
        }
        #newExamBtn:hover {
            background: #cccccc;
            border-color: #cccccc;
        }

        /* * ADIM 4: RESPONSIVE (DUYARLI) TASARIM
         * - Küçük ekranlarda (tablet, mobil) düzenin bozulmaması sağlanmıştır.
        */
        @media (max-width: 992px) {
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; max-height: 250px; }
        }

        @media (max-width: 768px) {
            .performance-sections { grid-template-columns: 1fr; }
            .modal-content { padding: 20px; margin: 20px 10px; }
            .main-timer { font-size: 40px; }
            .question-timer { font-size: 60px; }
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="header">
        <h1 class="app-title">Sınav Kronometresi</h1>
        <div class="main-timer" id="mainTimer">00:00:00</div>
        <div class="control-buttons">
            <button id="startBtn">Sınavı Başlat</button>
            <button id="pauseBtn" class="hidden">Duraklat</button>
            <button id="summaryBtn" class="hidden">Sınav Özeti</button>
        </div>
    </div>

    <div class="main-container">
        <div class="main-content">
            <div class="question-number" id="questionNumber">Sınav Başlamadı</div>
            <div class="question-timer" id="questionTimer">00:00</div>
            <button id="nextQuestionBtn" disabled>Sıradaki Soru (Enter)</button>
        </div>

        <div class="sidebar">
            <h2>Soru Süreleri</h2>
            <div class="question-list" id="questionList"></div>
        </div>
    </div>

    <div id="summaryModal" class="modal">
        <div class="modal-content">
            <span class="close-icon" id="closeModalIcon">&times;</span>
            <div class="modal-header">
                <h2>Sınav Performans Özeti</h2>
            </div>
            <div class="summary-grid" id="summaryGrid"></div>
            <div class="performance-sections">
                <div class="performance-section">
                    <h3>🚀 En Hızlı 5 Soru</h3>
                    <ul class="performance-list fastest-list" id="fastestList"></ul>
                </div>
                <div class="performance-section">
                    <h3>🐢 En Yavaş 5 Soru</h3>
                    <ul class="performance-list slowest-list" id="slowestList"></ul>
                </div>
            </div>
            <div class="detailed-table-container">
                 <h3 style="color: #808080; font-size: 14px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; font-weight: 400;">📋 Tüm Sorular</h3>
                <table class="detailed-table">
                    <thead><tr><th>Soru No</th><th>Süre</th><th>Ortalamadan Fark</th></tr></thead>
                    <tbody id="detailedTableBody"></tbody>
                </table>
            </div>
            <div class="modal-actions">
                <button id="closeModalBtn">Kapat ve Devam Et</button>
                <button id="newExamBtn">Yeni Sınav Başlat</button>
            </div>
        </div>
    </div>

    <script>
    // ADIM 5: JAVASCRIPT DEĞİŞKENLERİNİ TANIMLAMA

    // Yüksek hassasiyetli zamanlayıcı için değişkenler
    let displayUpdateInterval = null; // Ekranı güncelleyen interval'i tutar
    let examStartTime = 0;           // Sınavın başladığı anın milisaniye cinsinden zaman damgası
    let questionStartTime = 0;       // Mevcut sorunun başladığı anın zaman damgası
    let pauseTime = 0;               // Duraklatıldığı anın zaman damgası

    // Uygulama durumu ve verileri
    let mainSeconds = 0;             // Ekranda gösterilen toplam saniye
    let questionSeconds = 0;         // Ekranda gösterilen soru saniyesi
    let currentQuestion = 1;
    let questionTimes = [];
    let isPaused = false;
    let examStarted = false;

    // ADIM 6: HTML ELEMENTLERİNİ SEÇME
    const mainTimerEl = document.getElementById('mainTimer');
    const questionTimerEl = document.getElementById('questionTimer');
    const questionNumberEl = document.getElementById('questionNumber');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const summaryBtn = document.getElementById('summaryBtn'); // Yeni özet butonu
    const nextQuestionBtn = document.getElementById('nextQuestionBtn');
    const questionListEl = document.getElementById('questionList');
    const summaryModal = document.getElementById('summaryModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const closeModalIcon = document.getElementById('closeModalIcon');
    const newExamBtn = document.getElementById('newExamBtn');

    // ADIM 7: YARDIMCI ZAMAN FORMATLAMA FONKSİYONU
    function formatTime(totalSeconds, includeHours = true) {
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        if (includeHours) {
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // ADIM 8: YÜKSEK HASSASİYETLİ ZAMANLAYICI MANTIĞI

    /**
     * Bu fonksiyon, geçen gerçek zamanı Date.now() ile hesaplar ve ekranı günceller.
     * setInterval sadece bu fonksiyonu düzenli aralıklarla tetikler.
     * Zamanı saymak yerine, her seferinde yeniden hesaplar, bu da doğruluğu garantiler.
     */
    function updateDisplay() {
        if (!isPaused && examStarted) {
            const now = Date.now();
            
            // Toplam geçen süreyi hesapla
            const mainElapsedMillis = now - examStartTime;
            mainSeconds = Math.floor(mainElapsedMillis / 1000);
            mainTimerEl.textContent = formatTime(mainSeconds);
            
            // Soru için geçen süreyi hesapla
            const questionElapsedMillis = now - questionStartTime;
            questionSeconds = Math.floor(questionElapsedMillis / 1000);
            questionTimerEl.textContent = formatTime(questionSeconds, false);
        }
    }

    // ADIM 9: UYGULAMA KONTROL FONKSİYONLARI

    /** Sınavı başlatır. */
    function startExam() {
        examStarted = true;

        // Başlangıç zaman damgalarını ayarla
        const now = Date.now();
        examStartTime = now;
        questionStartTime = now;
        
        // Butonların durumunu güncelle
        startBtn.classList.add('hidden');
        pauseBtn.classList.remove('hidden');
        summaryBtn.classList.remove('hidden');
        nextQuestionBtn.disabled = false;

        questionNumberEl.textContent = `Soru ${currentQuestion}`;
        
        // Ekran güncelleme döngüsünü başlat
        displayUpdateInterval = setInterval(updateDisplay, 250); // Saniyede 4 kez günceller, akıcı görünür
    }

    /** Sınavı duraklatır veya devam ettirir. */
    function togglePause() {
        isPaused = !isPaused;
        
        if (isPaused) {
            // Duraklatma
            pauseTime = Date.now();
            pauseBtn.textContent = 'Devam Et';
            pauseBtn.classList.add('active');
            nextQuestionBtn.disabled = true;
        } else {
            // Devam Etme
            const pausedDuration = Date.now() - pauseTime;
            
            // Duraklatılan süreyi başlangıç zamanlarına ekleyerek zamanı "kaydırıyoruz".
            // Böylece kronometre kaldığı yerden doğru şekilde devam eder.
            examStartTime += pausedDuration;
            questionStartTime += pausedDuration;

            pauseBtn.textContent = 'Duraklat';
            pauseBtn.classList.remove('active');
            nextQuestionBtn.disabled = false;
        }
    }

    /** Sıradaki soruya geçer. */
    function handleNextQuestion() {
        if (isPaused || !examStarted) return;

        // Mevcut sorunun süresini kaydet
        questionTimes.push({
            questionNo: currentQuestion,
            time: questionSeconds
        });

        // Sağ paneldeki listeye ekle
        const listItem = document.createElement('div');
        listItem.className = 'question-item';
        listItem.innerHTML = `<span>Soru ${currentQuestion}</span><span class="time-cell">${formatTime(questionSeconds, false)}</span>`;
        questionListEl.appendChild(listItem);
        questionListEl.scrollTop = questionListEl.scrollHeight;

        // Sonraki soruya geç
        currentQuestion++;
        questionStartTime = Date.now(); // Yeni soru için başlangıç zamanını sıfırla
        
        questionNumberEl.textContent = `Soru ${currentQuestion}`;
    }
    
    /** Uygulamayı başlangıç durumuna sıfırlar. */
    function resetApplication() {
        clearInterval(displayUpdateInterval);

        // Değişkenleri sıfırla
        mainSeconds = 0; questionSeconds = 0;
        currentQuestion = 1; questionTimes = [];
        isPaused = false; examStarted = false;
        examStartTime = 0; questionStartTime = 0; pauseTime = 0;

        // Ekranı temizle
        mainTimerEl.textContent = '00:00:00';
        questionTimerEl.textContent = '00:00';
        questionNumberEl.textContent = 'Sınav Başlamadı';
        questionListEl.innerHTML = '';
        
        // Butonları başlangıç durumuna getir
        startBtn.classList.remove('hidden');
        pauseBtn.classList.add('hidden');
        summaryBtn.classList.add('hidden');
        pauseBtn.textContent = 'Duraklat';
        pauseBtn.classList.remove('active');
        nextQuestionBtn.disabled = true;
        
        hideSummary();
    }

    // ADIM 10: ÖZET EKRANI (MODAL) FONKSİYONLARI

    /** Sınav özetini gösterir. */
    function viewSummary() {
        if (!examStarted) return;
        
        // Özet açıldığında sınav zaten duraklatılmamışsa, duraklat.
        if (!isPaused) {
            togglePause();
        }
        showSummaryModal();
    }
    
    /** İstatistikleri hesaplar ve modalı ekranda gösterir. */
    function showSummaryModal() {
        // Eğer o an çözülen bir soru varsa, onu da geçici olarak listeye ekleyerek özet çıkar.
        const currentQuestionData = { questionNo: currentQuestion, time: questionSeconds };
        const allTimesForSummary = [...questionTimes, currentQuestionData];

        if (allTimesForSummary.length === 0 || (allTimesForSummary.length === 1 && allTimesForSummary[0].time === 0)) {
            alert('Özet göstermek için en az bir süre kaydedilmiş olmalı.');
            return;
        }

        // İstatistikleri hesapla
        const totalQuestions = allTimesForSummary.length;
        const totalQuestionTime = allTimesForSummary.reduce((sum, q) => sum + q.time, 0);
        const avgTime = Math.round(totalQuestionTime / totalQuestions);
        const sortedByTime = [...allTimesForSummary].sort((a, b) => a.time - b.time);
        const fastest5 = sortedByTime.slice(0, 5);
        const slowest5 = sortedByTime.slice(-5).reverse();
        
        document.getElementById('summaryGrid').innerHTML = `
            <div class="stat-card"><div class="stat-label">Toplam Süre</div><div class="stat-value">${formatTime(mainSeconds)}</div></div>
            <div class="stat-card"><div class="stat-label">Görüntülenen Soru</div><div class="stat-value">${totalQuestions}</div></div>
            <div class="stat-card"><div class="stat-label">Ortalama Süre</div><div class="stat-value">${formatTime(avgTime, false)}</div></div>
            <div class="stat-card"><div class="stat-label">En Hızlı Soru</div><div class="stat-value">${formatTime(fastest5[0].time, false)}</div><div class="stat-subvalue">Soru ${fastest5[0].questionNo}</div></div>
            <div class="stat-card"><div class="stat-label">En Yavaş Soru</div><div class="stat-value">${formatTime(slowest5[0].time, false)}</div><div class="stat-subvalue">Soru ${slowest5[0].questionNo}</div></div>
        `;
        
        document.getElementById('fastestList').innerHTML = fastest5.map(q => `<li><span>Soru ${q.questionNo}</span><span class="time-cell">${formatTime(q.time, false)}</span></li>`).join('');
        document.getElementById('slowestList').innerHTML = slowest5.map(q => `<li><span>Soru ${q.questionNo}</span><span class="time-cell">${formatTime(q.time, false)}</span></li>`).join('');

        document.getElementById('detailedTableBody').innerHTML = allTimesForSummary.map(q => {
            const diff = q.time - avgTime;
            const diffStr = diff > 0 ? `+${diff}s` : `${diff}s`;
            const diffColor = diff > 10 ? '#bbbbbb' : (diff < -10 ? '#888888' : '#aaaaaa');
            return `<tr><td>Soru ${q.questionNo}</td><td class="time-cell">${formatTime(q.time, false)}</td><td style="color: ${diffColor}; font-family: 'SF Mono', Monaco, 'Courier New', monospace;">${diffStr}</td></tr>`;
        }).join('');

        summaryModal.style.display = 'flex';
    }

    function hideSummary() {
        summaryModal.style.display = 'none';
    }

    // ADIM 11: OLAY DİNLEYİCİLERİ (EVENT LISTENERS)

    startBtn.addEventListener('click', startExam);
    pauseBtn.addEventListener('click', togglePause);
    summaryBtn.addEventListener('click', viewSummary); // "Sınavı Bitir" yerine geldi
    nextQuestionBtn.addEventListener('click', handleNextQuestion);

    closeModalBtn.addEventListener('click', hideSummary);
    closeModalIcon.addEventListener('click', hideSummary);
    
    newExamBtn.addEventListener('click', resetApplication);

    document.addEventListener('keydown', (event) => {
        if ((event.code === 'Enter' || event.code === 'Space') && !nextQuestionBtn.disabled) {
            event.preventDefault();
            handleNextQuestion();
        }
    });

    window.addEventListener('click', (event) => {
        if (event.target == summaryModal) {
            hideSummary();
        }
    });
    </script>
</body>
</html>